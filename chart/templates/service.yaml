{{- $root := . -}}
{{- range $idx, $raw := .Values.apps }}
{{- $appYaml := include "ai-workloads.applyKindDefaults" (dict "root" $root "obj" $raw) }}
{{- $app := fromYaml $appYaml }}
{{- $svc := $app.service | default dict }}

{{- if and $svc.enabled $svc.ports }}
  {{- $ctx := dict "root" $root "app" $app "type" (default "ClusterIP" $svc.type) "ports" $svc.ports }}
{{ include "ai-workloads.serviceTemplate" $ctx }}
---
{{- end }}

{{- end }}
