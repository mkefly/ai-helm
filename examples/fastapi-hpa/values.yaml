ai-workloads:
  apps:
    - name: fastapi-app
      kind: fastapi
      infraProfile: cpu-small
      replicas: 2

      image:
        repository: ghcr.io/acme/fastapi-app
        tag: v1.0.0

      service:
        enabled: true
        type: ClusterIP
        ports:
          - name: http
            port: 8000
            protocol: TCP

      settings: |
        {
          "runtime": {
            "logLevel": "info",
            "featureFlags": ["beta-endpoints"]
          }
        }

      env:
        - name: LOG_LEVEL
          value: info
        - name: FEATURE_FLAGS
          value: beta-endpoints

      podAnnotations:
        traffic.sidecar.istio.io/excludeInboundPorts: "8000"

      hpa:
        enabled: true
        minReplicas: 2
        maxReplicas: 8
        metrics:
          - type: Resource
            resource:
              name: cpu
              target:
                type: Utilization
                averageUtilization: 60

  batchTasks: []
